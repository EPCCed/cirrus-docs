
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../singularity/">
      
      
        <link rel="next" href="../gpu/">
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>Using Python - Cirrus User Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/cirrus.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-3T9RVR5FTP"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-3T9RVR5FTP",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-3T9RVR5FTP",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cirrus User Documentation" class="md-header__button md-logo" aria-label="Cirrus User Documentation" data-md-component="logo">
      
  <img src="../../images/cirrus_logo_white-Transparent-Background.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cirrus User Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using Python
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/EPCCed/cirrus-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    EPCCed/cirrus-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cirrus User Documentation" class="md-nav__button md-logo" aria-label="Cirrus User Documentation" data-md-component="logo">
      
  <img src="../../images/cirrus_logo_white-Transparent-Background.png" alt="logo">

    </a>
    Cirrus User Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EPCCed/cirrus-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    EPCCed/cirrus-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../connecting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to Cirrus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Management and Transfer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../resource_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File and Resource Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Development Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running Jobs on Cirrus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../singularity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Singularity Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Using Python
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Using Python
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mpi4py-for-cpu" class="md-nav__link">
    mpi4py for CPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi4py-for-gpu" class="md-nav__link">
    mpi4py for GPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning-frameworks" class="md-nav__link">
    Machine Learning frameworks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-your-own-python-packages-with-pip" class="md-nav__link">
    Installing your own Python packages (with pip)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-your-own-python-packages-with-conda" class="md-nav__link">
    Installing your own Python packages (with conda)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-jupyterlab-on-cirrus" class="md-nav__link">
    Using JupyterLab on Cirrus
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using the Cirrus GPU Nodes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../solidstate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solid state storage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Software Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/castep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Castep
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/cp2k/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CP2K
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/elements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ELEMENTS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/flacs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FLACS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/gaussian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gaussian
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/gromacs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GROMACS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/helyx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HELYX&reg;
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/lammps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LAMMPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/MATLAB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MATLAB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/namd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NAMD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/openfoam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenFOAM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/orca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ORCA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/qe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quantum Espresso (QE)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/starccm%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STAR-CCM+
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/vasp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VASP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/specfem3d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPECFEM3D Cartesian
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Libraries
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Software Libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/intel_mkl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intel MKL: BLAS, LAPACK, ScaLAPACK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/hdf5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDF5
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Software Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-tools/ddt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging using Arm DDT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-tools/scalasca/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profiling using Scalasca
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../software-tools/intel-vtune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intel VTune
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../reading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References and further reading
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mpi4py-for-cpu" class="md-nav__link">
    mpi4py for CPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi4py-for-gpu" class="md-nav__link">
    mpi4py for GPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning-frameworks" class="md-nav__link">
    Machine Learning frameworks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-your-own-python-packages-with-pip" class="md-nav__link">
    Installing your own Python packages (with pip)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-your-own-python-packages-with-conda" class="md-nav__link">
    Installing your own Python packages (with conda)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-jupyterlab-on-cirrus" class="md-nav__link">
    Using JupyterLab on Cirrus
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="using-python">Using Python</h1>
<p>Python on Cirrus is provided by a number of
<a href="https://conda.io/miniconda.html">Miniconda</a> modules and one
<a href="https://www.continuum.io">Anaconda</a> module. (Miniconda being a small
bootstrap version of Anaconda).</p>
<p>The Anaconda module is called <code>anaconda/python3</code> and is suitable for
running serial applications - for parallel applications using <code>mpi4py</code>
see <a href="#mpi4py-for-cpu">mpi4py for CPU</a> or <a href="#mpi4py-for-gpu">mpi4py for GPU</a>.</p>
<p>You can list the Miniconda modules by running <code>module avail python</code> on a
login node. Those module versions that have the <code>gpu</code> suffix are
suitable for use on the <a href="../gpu">Cirrus GPU nodes</a>. There are also
modules that extend these Python environments, e.g., <code>pyfr</code>, <code>horovod</code>,
<code>tensorflow</code> and <code>pytorch</code> - simply run <code>module help &lt;module name&gt;</code> for
further info.</p>
<p>The Miniconda modules support Python-based parallel codes, i.e., each
such <code>python</code> module provides a suite of packages pertinent to parallel
processing and numerical analysis such as <code>dask</code>, <code>ipyparallel</code>,
<code>jupyter</code>, <code>matplotlib</code>, <code>numpy</code>, <code>pandas</code> and <code>scipy</code>.</p>
<p>All the packages provided by a module can be obtained by running
<code>pip list</code>. We now give some examples that show how the <code>python</code> modules
can be used on the Cirrus CPU/GPU nodes.</p>
<h2 id="mpi4py-for-cpu">mpi4py for CPU</h2>
<p>The <code>python/3.9.13</code> module provides mpi4py 3.1.3 linked with OpenMPI
4.1.4.</p>
<p>See <code>numpy-broadcast.py</code> below which is a simple MPI Broadcast example,
and the Slurm script <code>submit-broadcast.slurm</code> which demonstrates how to
run across it two compute nodes.</p>
<details><summary><b>numpy-broadcast.py</b></summary>

<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Parallel Numpy Array Broadcast </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">Get_processor_name</span><span class="p">()</span>

<span class="n">arraySize</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">arraySize</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">arraySize</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>

<span class="n">comm</span><span class="o">.</span><span class="n">Bcast</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s2">&quot;Rank </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) has broadcast </span><span class="si">%d</span><span class="s2"> integers.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arraySize</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s2">&quot;Rank </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) has received </span><span class="si">%d</span><span class="s2"> integers.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arraySize</span><span class="p">))</span>

    <span class="n">arrayBad</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">arrayBad</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">arrayBad</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;Error, rank </span><span class="si">%d</span><span class="s2"> array is not as expected.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">rank</span><span class="p">))</span>
</code></pre></div>

</details>
<p><br></p>
<p>The MPI initialisation is done automatically as a result of calling
<code>from mpi4py import MPI</code>.</p>
<details><summary><b>submit-broadcast.slurm</b></summary>

<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Slurm job options (name, compute nodes, job time)</span>
<span class="c1">#SBATCH --job-name=broadcast</span>
<span class="c1">#SBATCH --time=00:20:00</span>
<span class="c1">#SBATCH --exclusive</span>
<span class="c1">#SBATCH --partition=standard</span>
<span class="c1">#SBATCH --qos=standard</span>
<span class="c1">#SBATCH --account=[budget code]</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --tasks-per-node=36</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>

module<span class="w"> </span>load<span class="w"> </span>python/3.9.13

<span class="nb">export</span><span class="w"> </span><span class="nv">OMPI_MCA_mca_base_component_show_load_errors</span><span class="o">=</span><span class="m">0</span>

srun<span class="w"> </span>numpy-broadcast.py
</code></pre></div>

</details>
<p><br></p>
<p>The Slurm submission script (<code>submit-broadcast.slurm</code>) above sets a
<code>OMPI_MCA</code> environment variable before launching the job. That
particular variable suppresses warnings written to the job output file;
it can of course be removed. Please see the <a href="https://www.open-mpi.org/faq/?category=tuning#mca-def">OpenMPI
documentation</a>
for info on all <code>OMPI_MCA</code> variables.</p>
<h2 id="mpi4py-for-gpu">mpi4py for GPU</h2>
<p>There's also an mpi4py module (again using OpenMPI 4.1.4) that is
tailored for CUDA 11.6 on the Cirrus GPU nodes, <code>python/3.9.13-gpu</code>. We
show below an example that features an MPI reduction performed on a
<a href="https://docs.cupy.dev/en/stable/overview.html">CuPy array</a>
(<code>cupy-allreduce.py</code>).</p>
<details><summary><b>cupy-allreduce.py</b></summary>

<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Reduce-to-all CuPy Arrays </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">Get_processor_name</span><span class="p">()</span>

<span class="n">sendbuf</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
<span class="n">recvbuf</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">sendbuf</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sendbuf</span><span class="p">,</span> <span class="s1">&#39;__cuda_array_interface__&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">recvbuf</span><span class="p">,</span> <span class="s1">&#39;__cuda_array_interface__&#39;</span><span class="p">)</span>
<span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_current_stream</span><span class="p">()</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
<span class="n">comm</span><span class="o">.</span><span class="n">Allreduce</span><span class="p">(</span><span class="n">sendbuf</span><span class="p">,</span> <span class="n">recvbuf</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">cp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">recvbuf</span><span class="p">,</span> <span class="n">sendbuf</span><span class="o">*</span><span class="n">size</span><span class="p">)</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): recvbuf = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="o">%</span> <span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">recvbuf</span><span class="p">)))</span>
</code></pre></div>

</details>
<p><br></p>
<p>By default, the CuPy cache will be located within the user's home
directory. And so, as <code>/home</code> is not accessible from the GPU nodes, it
is necessary to set <code>CUPY_CACHE_DIR</code> such that the cache is on the
<code>/work</code> file system instead.</p>
<details><summary><b>submit-allreduce.slurm</b></summary>

<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --job-name=allreduce</span>
<span class="c1">#SBATCH --time=00:20:00</span>
<span class="c1">#SBATCH --exclusive</span>
<span class="c1">#SBATCH --partition=gpu</span>
<span class="c1">#SBATCH --qos=gpu</span>
<span class="c1">#SBATCH --account=[budget code]</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --gres=gpu:4</span>

module<span class="w"> </span>load<span class="w"> </span>python/3.9.13-gpu

<span class="nb">export</span><span class="w"> </span><span class="nv">CUPY_CACHE_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="p">/home/work</span><span class="si">}</span>/.cupy/kernel_cache

<span class="nb">export</span><span class="w"> </span><span class="nv">OMPI_MCA_mpi_warn_on_fork</span><span class="o">=</span><span class="m">0</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OMPI_MCA_mca_base_component_show_load_errors</span><span class="o">=</span><span class="m">0</span>

srun<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">8</span><span class="w"> </span>--tasks-per-node<span class="o">=</span><span class="m">4</span><span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>cupy-allreduce.py
</code></pre></div>

</details>
<p><br></p>
<p>Again, the submission script (<code>submit-allreduce.slurm</code>) is the place to
set <code>OMPI_MCA</code> variables - the two shown are optional, see the link
below for further details.</p>
<p><a href="https://www.open-mpi.org/faq/?category=tuning#mca-def">https://www.open-mpi.org/faq/?category=tuning#mca-def</a></p>
<h2 id="machine-learning-frameworks">Machine Learning frameworks</h2>
<p>There are several more Python-based modules that also target the Cirrus
GPU nodes. These include two machine learning frameworks,
<code>pytorch/1.12.1-gpu</code> and <code>tensorflow/2.9.1-gpu</code>. Both modules are Python
virtual environments that extend <code>python/3.9.13-gpu</code>. The MPI comms is
handled by the <a href="https://horovod.readthedocs.io/en/stable/">Horovod</a>
0.25.0 package along with the <a href="https://developer.nvidia.com/nccl">NVIDIA Collective Communications
Library</a> v2.11.4.</p>
<p>A full package list for these environments can be obtained by loading
the module of interest and then running <code>pip list</code>.</p>
<p>Please click on the link indicated to see examples of how to use the
<a href="https://github.com/hpc-uk/build-instructions/blob/main/pyenvs/horovod/run_horovod_0.25.0_cirrus_gpu.md">PyTorch and TensorFlow
modules</a>
.</p>
<h2 id="installing-your-own-python-packages-with-pip">Installing your own Python packages (with pip)</h2>
<p>This section shows how to setup a local custom Python environment such
that it extends a centrally-installed <code>python</code> module. By extend, we
mean being able to install packages locally that are not provided by the
central <code>python</code>. This is needed because some packages such as <code>mpi4py</code>
must be built specifically for the Cirrus system and so are best
provided centrally.</p>
<p>You can do this by creating a lightweight <strong>virtual</strong> environment where
the local packages can be installed. Further, this environment is
created on top of an existing Python installation, known as the
environment's <strong>base</strong> Python.</p>
<p>Select the base Python by loading the <code>python</code> module you wish to
extend, e.g., <code>python/3.9.13-gpu</code> (you can run <code>module avail python</code> to
list all the available <code>python</code> modules).</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>python/3.9.13
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In the commands below, remember to replace <code>x01</code> with your project code
and <code>auser</code> with your username. </p>
</div>
<p>Next, create the virtual environment within a designated folder:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--system-site-packages<span class="w"> </span>/work/x01/x01/auser/myvenv
</code></pre></div>
<p>In our example, the environment is created within a <code>myvenv</code> folder
located on <code>/work</code>, which means the environment will be accessible from
the compute nodes. The <code>--system-site-packages</code> option ensures that this
environment is based on the currently loaded <code>python</code> module. See
<a href="https://docs.python.org/3/library/venv.html">https://docs.python.org/3/library/venv.html</a> for more details.</p>
<div class="highlight"><pre><span></span><code>extend-venv-activate<span class="w"> </span>/work/x01/x01/auser/myvenv
</code></pre></div>
<p>The <code>extend-venv-activate</code> command ensures that your virtual
environment's activate script loads and unloads the base <code>python</code> module
when appropriate. You're now ready to activate your environment.</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>/work/x01/x01/auser/myvenv/bin/activate
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The path above uses a fictitious project code, <code>x01</code>, and username,
<code>auser</code>. Please remember to replace those values with your actual
project code and username. Alternatively, you could enter
<code>${HOME/home/work}</code> in place of <code>/work/x01/x01/auser</code>. That command
fragment expands <code>${HOME}</code> and then replaces the <code>home</code> part with
<code>work</code>.</p>
</div>
<p>Installing packages to your local environment can now be done as
follows.</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>myvenv<span class="o">)</span><span class="w"> </span><span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>&lt;package<span class="w"> </span>name&gt;
</code></pre></div>
<p>Running <code>pip</code> directly as in <code>pip install &lt;package name&gt;</code> will also
work, but we show the <code>python -m</code> approach as this is consistent with
the way the virtual environment was created. And when you have finished
installing packages, you can deactivate your environment by issuing the
<code>deactivate</code> command.</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>myvenv<span class="o">)</span><span class="w"> </span><span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$<span class="w"> </span>deactivate
<span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$
</code></pre></div>
<p>The packages you have just installed locally will only be available once
the local environment has been activated. So, when running code that
requires these packages, you must first activate the environment, by
adding the activation command to the submission script, as shown below.</p>
<details><summary><b>submit-myvenv.slurm</b></summary>

<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --job-name=myvenv</span>
<span class="c1">#SBATCH --time=00:20:00</span>
<span class="c1">#SBATCH --exclusive</span>
<span class="c1">#SBATCH --partition=gpu</span>
<span class="c1">#SBATCH --qos=gpu</span>
<span class="c1">#SBATCH --account=[budget code]</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --gres=gpu:4</span>

<span class="nb">source</span><span class="w"> </span>/work/x01/x01/auser/myvenv/bin/activate

srun<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">8</span><span class="w"> </span>--tasks-per-node<span class="o">=</span><span class="m">4</span><span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">10</span><span class="w"> </span>myvenv-script.py
</code></pre></div>

</details>
<p><br></p>
<p>Lastly, the environment being extended does not have to come from one of
the centrally-installed <code>python</code> modules. You could just as easily
create a local virtual environment based on one of the Machine Learning
(ML) modules, e.g., <code>horovod</code>, <code>tensorflow</code> or <code>pytorch</code>. This means you
would avoid having to install ML packages within your local area. Each
of those ML modules is based on a <code>python</code> module. For example,
<code>tensorflow/2.11.0-gpu</code> is itself an extension of <code>python/3.10.8-gpu</code>.</p>
<h2 id="installing-your-own-python-packages-with-conda">Installing your own Python packages (with conda)</h2>
<p>This section shows you how to setup a local custom Python environment
such that it duplicates a centrally-installed <code>python</code> module, ensuring
that your local <code>conda</code> environment will contain packages that are
compatible with the Cirrus system.</p>
<p>Select the base Python by loading the <code>python</code> module you wish to
duplicate, e.g., <code>python/3.9.13-gpu</code> (you can run <code>module avail python</code>
to list all the available <code>python</code> modules).</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>python/3.9.13
</code></pre></div>
<p>Next, create the folder for holding your <code>conda</code> environments. This
folder should be on the <code>/work</code> file system as <code>/home</code> is not accessible
from the compute nodes.</p>
<div class="highlight"><pre><span></span><code><span class="nv">CONDA_ROOT</span><span class="o">=</span>/work/x01/x01/auser/condaenvs
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">CONDA_ROOT</span><span class="si">}</span>
</code></pre></div>
<p>The following commands tell <code>conda</code> where to save your custom
environments and packages.</p>
<div class="highlight"><pre><span></span><code>conda<span class="w"> </span>config<span class="w"> </span>--prepend<span class="w"> </span>envs_dirs<span class="w"> </span><span class="si">${</span><span class="nv">CONDA_ROOT</span><span class="si">}</span>/envs
conda<span class="w"> </span>config<span class="w"> </span>--prepend<span class="w"> </span>pkgs_dirs<span class="w"> </span><span class="si">${</span><span class="nv">CONDA_ROOT</span><span class="si">}</span>/pkgs
</code></pre></div>
<p>The <code>conda config</code> commands are executed just once and the configuration
details are held in a <code>.condarc</code> file located in your home directory.
You now need to move this <code>.condarc</code> file to a directory visible from
the compute nodes.</p>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>~/.condarc<span class="w"> </span><span class="si">${</span><span class="nv">CONDA_ROOT</span><span class="si">}</span>
</code></pre></div>
<p>You can now activate the <code>conda</code> configuration.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CONDARC</span><span class="o">=</span><span class="si">${</span><span class="nv">CONDA_ROOT</span><span class="si">}</span>/.condarc
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>conda<span class="w"> </span>shell.bash<span class="w"> </span>hook<span class="k">)</span><span class="s2">&quot;</span>
</code></pre></div>
<p>These two lines need to be called each time you want to use your virtual
<code>conda</code> environment. The next command creates that virtual environment.</p>
<div class="highlight"><pre><span></span><code>conda<span class="w"> </span>create<span class="w"> </span>--clone<span class="w"> </span>base<span class="w"> </span>--name<span class="w"> </span>myvenv
</code></pre></div>
<p>The above creates an environment called <code>myvenv</code> that will hold the same
packages provided by the base <code>python</code> module. As this command involves
a significant amount of file copying and downloading, it may take a long
time to complete. When it has completed please activate the local
<code>myvenv</code> conda environment.</p>
<div class="highlight"><pre><span></span><code>conda<span class="w"> </span>activate<span class="w"> </span>myvenv
</code></pre></div>
<p>You can now install packages using
<code>conda install -p ${CONDA_ROOT}/envs/myvenv &lt;package_name&gt;</code>. And you can
see the packages currently installed in the active environment with the
command <code>conda list</code>. After all packages have been installed, simply run
<code>conda deactivate</code> twice in order to restore the original comand prompt.</p>
<div class="highlight"><pre><span></span><code><span class="o">(</span>myvenv<span class="o">)</span><span class="w"> </span><span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$<span class="w"> </span>conda<span class="w"> </span>deactivate
<span class="o">(</span>base<span class="o">)</span><span class="w"> </span><span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$<span class="w"> </span>conda<span class="w"> </span>deactivate
<span class="o">[</span>auser@cirrus-login1<span class="w"> </span>auser<span class="o">]</span>$
</code></pre></div>
<p>The submission script below shows how to use the conda environment
within a job running on the compute nodes.</p>
<details><summary><b>submit-myvenv.slurm</b></summary>

<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --job-name=myvenv</span>
<span class="c1">#SBATCH --time=00:20:00</span>
<span class="c1">#SBATCH --exclusive</span>
<span class="c1">#SBATCH --partition=gpu</span>
<span class="c1">#SBATCH --qos=gpu</span>
<span class="c1">#SBATCH --account=[budget code]</span>
<span class="c1">#SBATCH --nodes=2</span>
<span class="c1">#SBATCH --gres=gpu:4</span>

module<span class="w"> </span>load<span class="w"> </span>python/3.9.13

<span class="nv">CONDA_ROOT</span><span class="o">=</span>/work/x01/x01/auser/condaenvs
<span class="nb">export</span><span class="w"> </span><span class="nv">CONDARC</span><span class="o">=</span><span class="si">${</span><span class="nv">CONDA_ROOT</span><span class="si">}</span>/.condarc
<span class="nb">eval</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>conda<span class="w"> </span>shell.bash<span class="w"> </span>hook<span class="k">)</span><span class="s2">&quot;</span>

conda<span class="w"> </span>activate<span class="w"> </span>myvenv

srun<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">8</span><span class="w"> </span>--tasks-per-node<span class="o">=</span><span class="m">4</span><span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">10</span><span class="w"> </span>myvenv-script.py
</code></pre></div>

</details>
<p><br></p>
<p>You can see that using <code>conda</code> is less convenient compared to <code>pip</code>. In
particular, the centrally-installed Python packages on copied in to the
local <code>conda</code> environment, consuming some of the disk space allocated to
your project. Secondly, activating the <code>conda</code> environment within a
submission script is more involved: five commands are required
(including an explicit load for the base <code>python</code> module), instead of
the single <code>source</code> command that is sufficient for a <code>pip</code> environment.</p>
<p>Further, <code>conda</code> cannot be used if the base environment is one of the
Machine Learning (ML) modules, as <code>conda</code> is not flexible enough to
gather Python packages from both the ML and base <code>python</code> modules (e.g.,
the ML module <code>pytorch/2.0.0-gpu</code> is itself based on
<code>python/3.10.8-gpu</code>, and so <code>conda</code> will only duplicate packages
provided by the <code>python</code> module and not the ones supplied by <code>pytorch</code>).</p>
<h2 id="using-jupyterlab-on-cirrus">Using JupyterLab on Cirrus</h2>
<p>It is possible to view and run JupyterLab on both the login and compute
nodes of Cirrus. Please note, you can test notebooks on the login nodes,
but please dont attempt to run any computationally intensive work (such
jobs will be killed should they reach the login node CPU limit).</p>
<p>If you want to run your JupyterLab on a compute node, you will need to
enter an <a href="../batch/#interactive-jobs">interactive session</a>; otherwise
you can start from a login node prompt.</p>
<ol>
<li>
<p>As described above, load the Anaconda module on Cirrus using
    <code>module load anaconda/python3</code>.</p>
</li>
<li>
<p>Run <code>export JUPYTER_RUNTIME_DIR=$(pwd)</code>.</p>
</li>
<li>
<p>Start the JupyterLab server by running
    <code>jupyter lab --ip=0.0.0.0 --no-browser</code></p>
<ul>
<li>once its started, you will see some lines resembling the
  following output.</li>
</ul>
<!-- -->
<pre><code>Or copy and paste one of these URLs:
    ...
 or http://127.0.0.1:8888/lab?token=&lt;string&gt;
</code></pre>
<p>You will need the URL shown above for step 6.</p>
</li>
<li>
<p>Please skip this step if you are connecting from Windows. If you are
    connecting from Linux or macOS, open a new terminal window, and run
    the following command.</p>
<pre><code>ssh &lt;username&gt;@login.cirrus.ac.uk -L&lt;port_number&gt;:&lt;node_id&gt;:&lt;port_number&gt;
</code></pre>
<p>where \&lt;username&gt; is your username, \&lt;port_number&gt; is as shown in
the URL from the Jupyter output and \&lt;node_id&gt; is the name of the
node were currently on. On a login node, this will be
<code>cirrus-login1</code>, or similar; on a compute node, it will be a mix of
numbers and letters such as <code>r2i5n5</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If, when you connect in the new terminal, you see a message of the
form <span class="title-ref">channel_setup_fwd_listener_tcpip:
cannot listen to port: 8888</span>, it means port 8888 is already in
use. You need to go back to step 3 (kill the existing jupyter lab)
and retry with a new explicit port number by adding the <code>--port=N</code>
option. The port number <code>N</code> can be in the range 5000-65535. You
should then use the same port number in place of 8888.</p>
</div>
</li>
<li>
<p>Please skip this step if you are connecting from Linux or macOS. If
    you are connecting from Windows, you should use MobaXterm to
    configure an SSH tunnel as follows.</p>
<p>5.1. Click on the <code>Tunnelling</code> button above the MobaXterm terminal.
Create a new tunnel by clicking on <code>New SSH tunnel</code> in the window
that opens.</p>
<p>5.2. In the new window that opens, make sure the
<code>Local port forwarding</code> radio button is selected.</p>
<p>5.3. In the <code>forwarded port</code> text box on the left under
<code>My computer with MobaXterm</code>, enter the port number indicated in the
Jupyter server output.</p>
<p>5.4. In the three text boxes on the bottom right under <code>SSH server</code>
enter <code>login.cirrus.ac.uk</code>, your Cirrus username, and then <code>22</code>.</p>
<p>5.5. At the top right, under <code>Remote server</code>, enter the name of the
Cirrus login or compute node that you noted earlier followed by the
port number (e.g. <span class="title-ref">8888</span>).</p>
<p>5.6. Click on the <code>Save</code> button.</p>
<p>5.7. In the tunnelling window, you will now see a new row for the
settings you just entered. If you like, you can give a name to the
tunnel in the leftmost column to identify it. Click on the small key
icon close to the right for the new connection to tell MobaXterm
which SSH private key to use when connecting to Cirrus. You should
tell it to use the same <code>.ppk</code> private key that you normally use.</p>
<p>5.8. The tunnel should now be configured. Click on the small start
button (like a play <code>&gt;</code> icon) for the new tunnel to open it. You'll
be asked to enter your Cirrus password -- please do so.</p>
</li>
<li>
<p>Now, if you open a browser window on your local machine, you should
    be able to navigate to the URL from step 3, and this should display
    the JupyterLab server.</p>
<ul>
<li>Please note, you will get a connection error if you haven't used
  the correct node name in step 4 or 5.</li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have extended a central Python venv following the
instructions about for <a href="#installing-your-own-python-packages-(with-pip)">Installing your own Python packages
(with pip)</a>,
Jupyter Lab will load the central ipython kernel, not the one
for your venv. To enable loading of the ipython kernel for your
venv from within Jupyter Lab, first install the ipykernel module
and then use this to install the kernel for your venv.
<div class="highlight"><pre><span></span><code>source /work/x01/x01/auser/myvenv/bin/activate
python -m pip install ipykernel
python -m ipykernel install --user --name=myvenv
</code></pre></div>
changing placeholder account and username as appropriate.
Thereafter, launch Jupyter Lab as above and select the <code>myvenv</code>
kernel.</p>
</div>
<p>If you are on a compute node, the JupyterLab server will be available
for the length of the interactive session you have requested.</p>
<p>You can also run Jupyter sessions using the centrally-installed
Miniconda3 modules available on Cirrus. For example, the following link
provides instructions for how to setup a Jupyter server on a GPU node.</p>
<p><a href="https://github.com/hpc-uk/build-instructions/tree/main/pyenvs/ipyparallel">https://github.com/hpc-uk/build-instructions/tree/main/pyenvs/ipyparallel</a></p>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/EPCCed" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>