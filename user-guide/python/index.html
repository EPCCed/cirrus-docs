
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../containers/">
      
      
        <link rel="next" href="../../software-packages/castep/">
      
      
        
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Using Python - Cirrus User Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/cirrus.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-3T9RVR5FTP"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-3T9RVR5FTP",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-3T9RVR5FTP",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cirrus User Documentation" class="md-header__button md-logo" aria-label="Cirrus User Documentation" data-md-component="logo">
      
  <img src="../../images/cirrus_logo_white-Transparent-Background.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cirrus User Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using Python
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/EPCCed/cirrus-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    EPCCed/cirrus-docs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cirrus User Documentation" class="md-nav__button md-logo" aria-label="Cirrus User Documentation" data-md-component="logo">
      
  <img src="../../images/cirrus_logo_white-Transparent-Background.png" alt="logo">

    </a>
    Cirrus User Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/EPCCed/cirrus-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    EPCCed/cirrus-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    New Cirrus EX4000 migration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    New Cirrus EX4000 migration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration-2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration-2025/not-migrating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Projects not continuing on Cirrus EX4000
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration-2025/account-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Account/Project Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration-2025/data-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../migration-2025/cirrus-differences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Differences from old Cirrus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hardware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connecting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connecting to Cirrus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Management and Transfer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resource_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File and Resource Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sw-environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scheduler and Running Jobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application Development Environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Containers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Using Python
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Python
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hpe-cray-python-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        HPE Cray Python distribution
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-your-own-python-packages-with-pip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing your own Python packages (with pip)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conda-on-archer2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conda on ARCHER2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conda on ARCHER2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conda-install-location" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conda install location
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conda install location">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-a-conda-container-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use a conda container image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-conda-on-the-work-file-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install conda on the work file system
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conda-additions-to-shell-configuration-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conda additions to shell configuration files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running Python
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-serial-python-submission-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example serial Python submission script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-mpi4py-job-submission-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example mpi4py job submission script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-jupyterlab-on-archer2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using JupyterLab on ARCHER2
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Software Applications
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software Applications
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/castep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CASTEP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/cp2k/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CP2K
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/gromacs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gromacs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/lammps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LAMMPS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/openfoam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenFOAM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/qe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quantum Espresso (QE)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/vasp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VASP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Software Libraries
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software Libraries
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/libsci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cray LibSci: BLAS, LAPACK, ScaLAPACK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/fftw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FFTW
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/hdf5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HDF5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-libraries/netcdf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NetCDF
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Software Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-tools/spack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spack
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software-tools/likwid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Likwid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hpe-cray-python-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      
        HPE Cray Python distribution
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-your-own-python-packages-with-pip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing your own Python packages (with pip)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conda-on-archer2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conda on ARCHER2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conda on ARCHER2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conda-install-location" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conda install location
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conda install location">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-a-conda-container-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use a conda container image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-conda-on-the-work-file-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install conda on the work file system
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conda-additions-to-shell-configuration-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conda additions to shell configuration files
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running Python
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-serial-python-submission-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example serial Python submission script
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-mpi4py-job-submission-script" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example mpi4py job submission script
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-jupyterlab-on-archer2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using JupyterLab on ARCHER2
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="using-python">Using Python</h1>
<p>Python is supported on Cirrus both for running intensive parallel jobs
and also as an analysis tool. This section describes how to use Python
in either of these scenarios.</p>
<p>The Python installations on Cirrus contain some of the most commonly
used packages. If you wish to install additional Python packages, we
recommend that you use the <code>pip</code> command, see the section entitled
<a href="./#installing-your-own-python-packages-with-pip">Installing your own Python packages (with pip)</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Python 2 is not supported on Cirrus as it has been deprecated since
the start of 2020. </p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you log onto Cirrus, no Python module is loaded by default. You
will generally need to load the <code>cray-python</code> module to access the
functionality described below.</p>
</div>
<h2 id="hpe-cray-python-distribution">HPE Cray Python distribution</h2>
<p>The recommended way to use Python on Cirrus is to use the HPE Cray
Python distribution.</p>
<p>The HPE Cray distribution provides Python 3 along with some of the most
common packages used for scientific computation and data analysis. These
include:</p>
<ul>
<li>numpy and scipy - built using GCC against HPE Cray LibSci</li>
<li>mpi4py - built using GCC against HPE Cray MPICH</li>
<li>dask</li>
</ul>
<p>The HPE Cray Python distribution can be loaded (either on the front-end
or in a submission script) using:</p>
<pre><code>module load cray-python
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The HPE Cray Python distribution is built using GCC compilers. If you wish
to compile your own Python, C/C++ or Fortran code to use with HPE Cray
Python, you should ensure that you compile using <code>PrgEnv-gnu</code> to make sure
they are compatible.</p>
</div>
<h2 id="installing-your-own-python-packages-with-pip">Installing your own Python packages (with pip)</h2>
<p>Sometimes, you may need to setup a local custom Python environment such that it extends a centrally-installed <code>cray-python</code> module.
By extend, we mean being able to install packages locally that are not provided by <code>cray-python</code>. This is necessary because some Python
packages such as <code>mpi4py</code> must be built specifically for the Cirrus system and so are best provided centrally.</p>
<p>You can do this by creating a lightweight <strong>virtual</strong> environment where the local packages can be installed. This environment
is created on top of an existing Python installation, known as the environment's <strong>base</strong> Python.</p>
<p>First, load the <code>PrgEnv-gnu</code> environment.</p>
<pre><code>[auser@login01:~]$ module load PrgEnv-gnu
</code></pre>
<p>This first step is necessary because subsequent <code>pip</code> installs may involve source code compilation and it is better that this be done using
the GCC compilers to maintain consistency with how some base Python packages have been built.</p>
<p>Second, select the base Python by loading the <code>cray-python</code> module that you wish to extend.</p>
<pre><code>[auser@login01:~]$ module load cray-python
</code></pre>
<p>Next, create the virtual environment within a designated folder.</p>
<pre><code>python -m venv --system-site-packages /work/t01/t01/auser/myvenv
</code></pre>
<p>In our example, the environment is created within a <code>myvenv</code> folder located on <code>/work</code>, which means the environment will be accessible
from the compute nodes. The <code>--system-site-packages</code> option ensures this environment is based on the currently loaded <code>cray-python</code>
module. See <a href="https://docs.python.org/3/library/venv.html">https://docs.python.org/3/library/venv.html</a> for more details.</p>
<p>You're now ready to <em>activate</em> your environment.</p>
<pre><code>source /work/t01/t01/auser/myvenv/bin/activate
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code>myvenv</code> path uses a fictitious project code, <code>t01</code>, and username, <code>auser</code>. Please remember to replace those values
with your actual project code and username. Alternatively, you could enter <code>${HOME/home/work}</code> in place of <code>/work/t01/t01/auser</code>.
That command fragment expands <code>${HOME}</code> and then replaces the <code>home</code> part with <code>work</code>.</p>
</div>
<p>Installing packages to your local environment can now be done as follows.</p>
<pre><code>(myvenv) [auser@login01:~]$ python -m pip install &lt;package name&gt;
</code></pre>
<p>Running <code>pip</code> directly as in <code>pip install &lt;package name&gt;</code> will also work, but we show the <code>python -m</code> approach
as this is consistent with the way the virtual environment was created. Further, if the package installation
will require code compilation, you should amend the command to ensure use of the Cirrus compiler wrappers.</p>
<pre><code>(myvenv) [auser@login01:~]$ CC=cc CXX=CC FC=ftn python -m pip install &lt;package name&gt;
</code></pre>
<p>And when you have finished installing packages, you can deactivate the environment by running the <code>deactivate</code> command.</p>
<pre><code>(myvenv) [auser@login01:~]$ deactivate
[auser@login01:~]$
</code></pre>
<p>The packages you have installed will only be available once the local environment has been activated. So, when running code that requires these packages,
you must first activate the environment, by adding the activation command to the submission script, as shown below.</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash --login

#SBATCH --job-name=myvenv
#SBATCH --exclusive
#SBATCH --nodes=2
#SBATCH --ntasks-per-node=288
#SBATCH --cpus-per-task=1
#SBATCH --time=00:10:00
#SBATCH --account=[budget code]
#SBATCH --partition=standard
#SBATCH --qos=standard

source /work/t01/t01/auser/myvenv/bin/activate

export SRUN_CPUS_PER_TASK=${SLURM_CPUS_PER_TASK}

srun --distribution=block:block --hint=nomultithread python myvenv-script.py
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you find that a module you've installed to a virtual environment on <code>/work</code> isn't found when running a job, it may be that it was previously installed to the default location of <code>$HOME/.local</code> which is not mounted on the compute nodes. This can be an issue as <code>pip</code> will reuse any modules found at this default location rather than reinstall them into a virtual environment. Thus, even if the virtual environment is on <code>/work</code>, a module you've asked for may actually be located on <code>/home</code>.</p>
<p>You can check a module's install location and its dependencies with <code>pip show</code>, for example <code>pip show matplotlib</code>. You may then run <code>pip uninstall matplotlib</code> while no virtual environment is active to uninstall it from <code>$HOME/.local</code>, and then re-run <code>pip install matplotlib</code> while your virtual environment on <code>/work</code> is active to reinstall it there. You will need to do this for any modules installed on <code>/home</code> that will use either directly or indirectly. Remember you can check all your installed modules with <code>pip list</code>.</p>
</div>
<h2 id="conda-on-archer2">Conda on ARCHER2</h2>
<p>Conda-based Python distributions (e.g. Anaconda, Mamba, Miniconda) are an extremely popular way of installing and
accessing software on many systems, including Cirrus. Although conda-based distributions can be used on Cirrus, 
care is needed in how they are installed and configured so that the installation does not adversely effect your use
of Cirrus. In particular, you should be careful of:</p>
<ul>
<li>Where you install conda on Cirrus</li>
<li>Conda additions to shell configuration files such as <code>.bashrc</code></li>
</ul>
<p>We cover each of these points in more detail below.</p>
<h3 id="conda-install-location">Conda install location</h3>
<p>If you only need to use the files and executables from your conda installation on the login and data analysis nodes
(via the <code>serial</code> QoS) then the best place to install conda is in your home directory structure - this will usually
be the default install location provided by the installation script.</p>
<p>If you need to access the files and executables from conda on the compute nodes then you will need to install to a 
different location as the home file systems are not available on the compute nodes. There are two main options for
using conda from Cirrus compute nodes:</p>
<ol>
<li>Use a conda container image </li>
<li>Install conda on the work file system</li>
</ol>
<h4 id="use-a-conda-container-image">Use a conda container image</h4>
<p>You can pull official conda-based container images from Dockerhub that you can use if you want just the standard
set of Python modules that come with the distribution. For example, to get the latest Anaconda distribution as an 
Apptainer container image on the Cirrus work file system, you would use (on an Cirrus login node, from the
directory on the work file system where you want to store the container image):</p>
<div class="highlight"><pre><span></span><code>apptainer build anaconda3.sif docker://continuumio/anaconda3
</code></pre></div>
<p>Once you have the container image, you can run scripts in it with a command like:</p>
<div class="highlight"><pre><span></span><code>apptainer exec -B $PWD anaconda3.sif python my_script.py
</code></pre></div>
<p>As the container image is a single large file, you end up doing a single large read from the work file system rather
than lots of small reads of individual Python files, this improves the performance of Python and reduces the 
detrimental impact on the wider file system performance for all users.</p>
<p>We have pre-built a Apptainer container with the Anaconda distribution in on 
ARCHER2. Users can access it at <code>$EPCC_CONTAINER_DIR/anaconda3.sif</code>. To run a Python
script with the centrally-installed image, you can use:</p>
<div class="highlight"><pre><span></span><code>apptainer exec -B $PWD $EPCC_CONTAINER_DIR/anaconda3.sif python my_script.py
</code></pre></div>
<p>If you want additional packages that are not available in the standard container images then
you will need to build your own container images. If you need help to do this, then please
contact the <a href="mailto:support@cirrus.ac.uk">Cirrus Service Desk</a></p>
<h4 id="install-conda-on-the-work-file-system">Install conda on the work file system</h4>
<p>To do this, specify an install location 
in your directories on the work file system when prompted in the conda installation process.</p>
<h3 id="conda-additions-to-shell-configuration-files">Conda additions to shell configuration files</h3>
<p>During the install process most conda-based distributions will ask a question like:</p>
<blockquote>
<p>Do you wish the installer to initialize Miniconda3 by running conda init?</p>
</blockquote>
<p>If you are installing to the Cirrus work directories, you 
should answer "no" to this question.</p>
<p>Adding the initialisation to shell startup scripts (typically <code>.bashrc</code>) means that every time
you login to Cirrus, the conda environment will try to initialise by reading lots of files
within the conda installation. This approach was designed for the case where a user has installed
conda on their personal device and so is the only user of the file system. For shared file systems
such as those on Cirrus, this places a large load on the file system and will lead to you seeing 
slow login times and slow response from your command line on Cirrus. It will also lead to degraded
read/write performance from the work file systems for you and other users so should be avoided at 
all costs.</p>
<p>If you have previously installed a conda distribution and answered "yes" to the question about
adding the initialisation to shell configuration files, you should edit your <code>~/.bashrc</code> file
to remove the conda initialisation entries. This means deleting the lines that look something
like:</p>
<div class="highlight"><pre><span></span><code># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;
# !! Contents within this block are managed by &#39;conda init&#39; !!
__conda_setup=&quot;$(&#39;/work/t01/t01/auser/miniconda3/bin/conda&#39; &#39;shell.bash&#39; &#39;hook&#39; 2&gt; /dev/null)&quot;
if [ $? -eq 0 ]; then
eval &quot;$__conda_setup&quot;
else
if [ -f &quot;/work/t01/t01/auser/miniconda3/etc/profile.d/conda.sh&quot; ]; then
. &quot;/work/t01/t01/auser/miniconda3/etc/profile.d/conda.sh&quot;
else
export PATH=&quot;/work/t01/t01/auser/miniconda3/bin:$PATH&quot;
fi
fi
unset __conda_setup
# &lt;&lt;&lt; conda initialize &lt;&lt;&lt;
</code></pre></div>
<h2 id="running-python">Running Python</h2>
<h3 id="example-serial-python-submission-script">Example serial Python submission script</h3>
<div class="highlight"><pre><span></span><code>#!/bin/bash --login

#SBATCH --job-name=python_test
#SBATCH --ntasks=1
#SBATCH --time=00:10:00

# Replace [budget code] below with your project code (e.g. t01)
#SBATCH --account=[budget code]
#SBATCH --partition=standard
#SBATCH --qos=standard

# Load the Python module, ...
module load cray-python

# ..., or, if using local virtual environment
source &lt;&lt;path to virtual environment&gt;&gt;/bin/activate

# Run your Python program
python python_test.py
</code></pre></div>
<h3 id="example-mpi4py-job-submission-script">Example mpi4py job submission script</h3>
<p>Programs that have been parallelised with mpi4py can be run on the Cirrus compute nodes.
Unlike the serial Python submission script however, we must launch the Python interpreter
using <code>srun</code>. Failing to do so will result in Python running a single MPI rank only. </p>
<div class="highlight"><pre><span></span><code>#!/bin/bash --login
# Slurm job options (job-name, compute nodes, job time)
#SBATCH --job-name=mpi4py_test
#SBATCH --nodes=2
#SBATCH --exclusive
#SBATCH --ntasks-per-node=288
#SBATCH --cpus-per-task=1
#SBATCH --time=0:10:0

# Replace [budget code] below with your budget code (e.g. t01)
#SBATCH --account=[budget code]
#SBATCH --partition=standard
#SBATCH --qos=standard

# Load the Python module, ...
module load cray-python

# ..., or, if using local virtual environment
source &lt;&lt;path to virtual environment&gt;&gt;/bin/activate

# Pass cpus-per-task setting to srun
export SRUN_CPUS_PER_TASK=${SLURM_CPUS_PER_TASK}

# Run your Python program
#   Note that srun MUST be used to wrap the call to python,
#   otherwise your code will run serially
srun --distribution=block:block --hint=nomultithread python mpi4py_test.py
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have installed your own packages you will need to activate your local Python
environment within your job submission script as shown at the end of
<a href="./#installing-your-own-python-packages-with-pip">Installing your own Python packages (with pip)</a>.</p>
</div>
<!-- Comment out until spindle is available

### Running Python at scale

The file system metadata server may become overloaded when running a parallel Python script over many fully populated nodes (i.e., 288 MPI ranks per node).
Performance degrades due to the IO operations that accompany a high volume of Python import statements. Typically, each import will first require the module or
library to be located by searching a number of file paths before the module is loaded into memory. Such a workload scales as *N<sub>p</sub>* x *N<sub>lib</sub>* x *N<sub>path</path>* ,
where *N<sub>p</sub>* is the number of parallel processes, *N<sub>lib</sub>* is the number of libraries imported and *N<sub>path</path>* the number of file paths searched. And so, in this way
much time can be lost during the initial phase of a large Python job, not to mention the fact that the IO contention will be impacting other users of the system.

[Spindle](https://computing.llnl.gov/projects/spindle) is a tool for improving the library-loading performance of dynamically linked HPC applications. It provides a
mechanism for scalable loading of shared libraries, executables and Python files from a shared file system at scale without turning the file system into a bottleneck.
This is achieved by caching libraries or their locations within node memory. Spindle takes a pure user-space approach: users do not need to configure new file systems,
load particular OS kernels or build special system components. The tool operates on existing binaries &mdash; no application modification or special build flags are required.

The script below shows how to run Spindle with your Python code.

<div class="highlight"><pre><span></span><code>#!/bin/bash --login

#SBATCH --nodes=256
#SBATCH --ntasks-per-node=128
...

module load cray-python
module load spindle/0.13

export SRUN_CPUS_PER_TASK=${SLURM_CPUS_PER_TASK}

spindle --slurm --python-prefix=/opt/cray/pe/python/${CRAY_PYTHON_LEVEL} \      
    srun --overlap --distribution=block:block --hint=nomultithread \
        python mpi4py_script.py
</code></pre></div>

The `--python-prefix` argument can be set to a list of colon-separated paths if necessary. In the example above,
the `CRAY_PYTHON_LEVEL` environment variable is set as a conseqeunce of loading `cray-python`.

!!! note
    The `srun --overlap` option is required for Spindle as the version of Slurm on ARCHER2 is newer than 20.11.

-->

<h2 id="using-jupyterlab-on-archer2">Using JupyterLab on ARCHER2</h2>
<p>It is possible to view and run Jupyter notebooks from both login nodes 
and compute nodes on Cirrus.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can test such notebooks on the login nodes, but please do not attempt to
run any computationally intensive work. Jobs may get killed once they hit a
CPU limit on login nodes.</p>
</div>
<p>Please follow these steps.</p>
<ol>
<li>
<p>Install JupyterLab in your work directory.
   <div class="highlight"><pre><span></span><code>module load cray-python
export PYTHONUSERBASE=/work/t01/t01/auser/.local
export PATH=$PYTHONUSERBASE/bin:$PATH
# source &lt;&lt;path to virtual environment&gt;&gt;/bin/activate  # If using a virtualenvironment uncomment this line and remove the --user flag from the next

pip install --user jupyterlab
</code></pre></div></p>
</li>
<li>
<p>If you want to test JupyterLab on the login node please go straight to step 3.
   To run your Jupyter notebook on a compute node, you first need to run an interactive session.
   <div class="highlight"><pre><span></span><code>srun --nodes=1 --exclusive --time=00:20:00 --account=&lt;your_budget&gt; \
     --partition=standard --qos=short \
     --pty /bin/bash
</code></pre></div>
   Your prompt will change to something like below.
   <div class="highlight"><pre><span></span><code>[auser@cs-n0034:/tmp]$
</code></pre></div>
   In this case, the node id is <code>cs-n0034</code>. Now execute the following on the compute node.
   <div class="highlight"><pre><span></span><code>cd /work/t01/t01/auser # Update the path to your work directory
export PYTHONUSERBASE=$(pwd)/.local
export PATH=$PYTHONUSERBASE/bin:$PATH
export HOME=$(pwd)
module load cray-python
# source &lt;&lt;path to virtual environment&gt;&gt;/bin/activate  # If using a virtualenvironment uncomment this line
</code></pre></div></p>
</li>
<li>
<p>Run the JupyterLab server.
   <div class="highlight"><pre><span></span><code>export JUPYTER_RUNTIME_DIR=$(pwd)
jupyter lab --ip=0.0.0.0 --no-browser
</code></pre></div>
   Once it's started, you will see a URL printed in the terminal window of 
   the form <code>http://127.0.0.1:&lt;port_number&gt;/lab?token=&lt;string&gt;</code>; we'll need this URL for
   step 6.</p>
</li>
<li>
<p>Please skip this step if you are connecting from a machine running Windows.
   Open a new terminal window on your laptop and run the following command.
   <div class="highlight"><pre><span></span><code>ssh &lt;username&gt;@login.cirrus.ac.uk -L&lt;port_number&gt;:&lt;node_id&gt;:&lt;port_number&gt;
</code></pre></div>
   where <code>&lt;username&gt;</code> is your username, and <code>&lt;node_id&gt;</code> is the id of the node you're 
   currently on (for a login node, this will be <code>login01</code>, or similar; on a compute 
   node, it will be a mix of numbers and letters). In our example, <code>&lt;node_id&gt;</code>
   is <code>cs-n0034</code>. Note, please use the same port number as that shown in the URL of
   step 3. This number may vary, likely values are 8888 or 8889.</p>
</li>
<li>
<p>Please skip this step if you are connecting from Linux or macOS. If you are connecting from Windows, you should use MobaXterm to configure an SSH tunnel as follows.</p>
<ul>
<li>Click on the <code>Tunnelling</code> button above the MobaXterm terminal. Create a new tunnel by clicking on <code>New SSH tunnel</code> in the window that opens.</li>
<li>In the new window that opens, make sure the <code>Local port forwarding</code> radio button is selected.</li>
<li>In the <code>forwarded port</code> text box on the left under <code>My computer with MobaXterm</code>, enter the port number indicated in the JupyterLab server output (e.g., 8888 or 8890).</li>
<li>In the three text boxes on the bottom right under <code>SSH server</code> enter <code>login.archer2.ac.uk</code>, your ARCHER2 username and then <code>22</code>.</li>
<li>At the top right, under <code>Remote server</code>, enter the id of the login or compute node running the JupyterLab server and the associated port number.</li>
<li>Click on the <code>Save</code> button.</li>
<li>In the tunnelling window, you will now see a new row for the settings you just entered. If you like, you can give a name to the tunnel in the leftmost column to identify it.</li>
<li>Click on the small key icon close to the right for the new connection to tell MobaXterm which SSH private key to use when connecting to ARCHER2. You should tell it to use the same <code>.ppk</code> private key that you normally use when connecting to ARCHER2.</li>
<li>The tunnel should now be configured. Click on the small start button (like a play '&gt;' icon) for the new tunnel to open it. You'll be asked to enter your ARCHER2 account password -- please do so.</li>
</ul>
</li>
<li>
<p>Now, if you open a browser window locally, you should be able to navigate to the URL
   from step 3, and this should display the JupyterLab server. If JupyterLab is running
   on a compute node, the notebook will be available for the length of the interactive
   session you have requested.</p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please do not use the other http address given by the JupyterLab output,
the one formatted <code>http://&lt;node_id&gt;:&lt;port_number&gt;/lab?token=&lt;string&gt;</code>. Your local
browser will not recognise the <code>&lt;node_id&gt;</code> part of the address.</p>
</div>
<!-- Comment out until Dask is tested

## Using Dask Job-Queue

The Dask-jobqueue project makes it easy to deploy Dask on Cirrus. 
You can find more information in 
[the Dask Job-Queue documentation](http://jobqueue.dask.org/en/latest/).

Please follow these steps:

1. Install Dask-Jobqueue

<div class="highlight"><pre><span></span><code>module load cray-python
export PYTHONUSERBASE=/work/t01/t01/auser/.local
export PATH=$PYTHONUSERBASE/bin:$PATH

pip install --user dask-jobqueue --upgrade
</code></pre></div>

2. Using Dask

Dask-jobqueue creates a Dask Scheduler in the Python process where the cluster
object is instantiated. A script for running dask jobs on Cirrus
might look something like this:

<div class="highlight"><pre><span></span><code>from dask_jobqueue import SLURMCluster
cluster = SLURMCluster(cores=288, 
                       processes=16,
                       memory=&#39;768GB&#39;,
                       queue=&#39;standard&#39;,
                       header_skip=[&#39;--mem&#39;],
                       job_extra=[&#39;--qos=&quot;standard&quot;&#39;],
                       python=&#39;srun python&#39;,
                       project=&#39;z19&#39;,
                       walltime=&quot;01:00:00&quot;,
                       shebang=&quot;#!/bin/bash --login&quot;,
                       local_directory=&#39;$PWD&#39;,
                       interface=&#39;hsn0&#39;,
                       env_extra=[&#39;module load cray-python&#39;,
                                  &#39;export PYTHONUSERBASE=/work/t01/t01/auser/.local/&#39;,
                                  &#39;export PATH=$PYTHONUSERBASE/bin:$PATH&#39;,
                                  &#39;export PYTHONPATH=$PYTHONUSERBASE/lib/python3.8/site-packages:$PYTHONPATH&#39;])



cluster.scale(jobs=2)    # Deploy two single-node jobs

from dask.distributed import Client
client = Client(cluster)  # Connect this local process to remote workers

# wait for jobs to arrive, depending on the queue, this may take some time
import dask.array as da
x =               # Dask commands now use these distributed resources
</code></pre></div>

This script can be run on the login nodes and it submits the Dask jobs
to the job queue. Users should ensure that the computationally intensive
work is done with the Dask commands which run on the compute nodes.

The cluster object parameters specify the characteristics for running on a single compute node.
The header_skip option is required as we are running on exclusive nodes where you should not
specify the memory requirements, however Dask requires you to supply this option.

Jobs are be deployed with the cluster.scale command, where the jobs option sets
the number of single node jobs requested. Job scripts are generated
(from the cluster object) and these are submitted to the queue to begin 
running once the resources are available. You can check the status of the jobs by 
running `squeue -u $USER` in a separate terminal.

If you wish to see the generated job script you can use:

<div class="highlight"><pre><span></span><code>print(cluster.job_script())
</code></pre></div>
-->









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/EPCCed" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["tabs"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>